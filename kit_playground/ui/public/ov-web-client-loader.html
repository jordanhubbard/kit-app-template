<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Loading Kit Streaming Client...</title>
    <style>
      html, body { height: 100%; margin: 0; font-family: system-ui, sans-serif; background: #0f1114; color: #e6e6e6; }
      .loader { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
      .spinner { width: 48px; height: 48px; border: 4px solid #2a2f37; border-top-color: #76b900; border-radius: 50%; animation: spin 0.8s linear infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
      .message { margin-top: 16px; font-size: 14px; color: #9aa0a6; }
    </style>
  </head>
  <body>
    <div class="loader">
      <div class="spinner"></div>
      <div class="message">Configuring streaming client...</div>
    </div>

    <script>
      (function() {
        // Parse URL parameters: ?server=host:port
        const params = new URLSearchParams(window.location.search);
        const serverParam = params.get('server');

        if (!serverParam) {
          document.querySelector('.message').textContent = 'Error: No server specified. Use ?server=host:port';
          return;
        }

        // Parse host and port
        const [host, portStr] = serverParam.split(':');
        const port = parseInt(portStr, 10) || 47995;

        // Update the stream config dynamically
        const config = {
          source: 'local',
          local: {
            server: host,
            signalingPort: port,
            mediaPort: null
          }
        };

        // Update the config file by posting to a dynamic config endpoint or modifying in-memory
        // For now, we'll redirect with the config embedded as a query param
        const configStr = encodeURIComponent(JSON.stringify(config));
        
        // Redirect to the actual web-viewer-sample built app
        // The client needs to be built first with: make streaming-client-build
        setTimeout(() => {
          // The ov-web-client will read from stream.config.json, so we need to override it
          // Store in sessionStorage as fallback
          sessionStorage.setItem('streamConfig', JSON.stringify(config));
          window.location.href = `/ov-web-client/dist/index.html?dynamicConfig=${configStr}`;
        }, 500);
      })();
    </script>
  </body>
</html>

